<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>A Magical Surprise for Amira ‚ú®</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&family=Montserrat:wght@300;600&display=swap');

        body {
            margin: 0; padding: 0;
            background: radial-gradient(circle, #2c3e50, #000000);
            display: flex; flex-direction: column;
            justify-content: center; align-items: center;
            height: 100vh; font-family: 'Montserrat', sans-serif;
            overflow: hidden; color: white;
        }

        /* Sparkles Background */
        .sparkle {
            position: absolute; background: white; border-radius: 50%;
            animation: twinkle 2s infinite; opacity: 0.5;
        }
        @keyframes twinkle { 0%, 100% { opacity: 0.3; } 50% { opacity: 1; } }

        /* Cake Container */
        .cake-container {
            position: relative; width: 300px; height: 400px;
            display: none; flex-direction: column;
            align-items: center; justify-content: flex-end;
        }

        @keyframes dropIn {
            0% { transform: translateY(-1000px); opacity: 0; }
            100% { transform: translateY(0); opacity: 1; }
        }

        .layer, .candle-wrapper {
            animation: dropIn 1s cubic-bezier(0.24, 0.4, 0.28, 1.18) forwards;
            opacity: 0; position: relative;
        }

        .layer-1 { 
            height: 90px; width: 260px; background: #a8e6cf; 
            border-radius: 20px 20px 10px 10px; animation-delay: 0.5s; z-index: 1;
            border-bottom: 8px solid #ffd700;
        }
        .layer-2 { 
            height: 70px; width: 200px; background: #dcedc1; 
            animation-delay: 1.5s; z-index: 2; border-radius: 15px; margin-bottom: -10px;
            border-bottom: 6px solid #ffd700;
        }
        .layer-3 { 
            height: 60px; width: 140px; background: #ffaaa5; 
            animation-delay: 2.5s; z-index: 3; border-radius: 12px; margin-bottom: -10px;
            border-bottom: 4px solid #ffd700;
        }

        .candle-wrapper { animation-delay: 3.5s; z-index: 10; margin-bottom: 10px; }
        .candle {
            width: 15px; height: 50px; background: gold;
            border-radius: 5px; position: relative;
        }
        .flame {
            width: 20px; height: 30px; background: radial-gradient(#fff, #ffeb3b, #ff9800);
            position: absolute; top: -35px; left: -2.5px;
            border-radius: 50% 50% 20% 20%; box-shadow: 0 0 20px #ff9800;
            animation: flicker 0.1s infinite alternate;
        }

        @keyframes flicker { from { transform: scale(1); } to { transform: scale(1.1); } }

        .status { margin-top: 30px; text-align: center; font-size: 1.1rem; padding: 0 20px; }
        #initBtn {
            padding: 15px 40px; background: #ffd700; color: #000;
            border: none; border-radius: 50px; cursor: pointer;
            font-weight: bold; font-family: 'Montserrat'; font-size: 1rem;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
        }

        #message {
            display: none; position: fixed; top: 50%; left: 50%;
            transform: translate(-50%, -50%); width: 85%; max-width: 450px;
            background: rgba(255, 255, 255, 0.98); padding: 30px; border-radius: 30px;
            text-align: center; color: #333; z-index: 100;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }

        h1 { font-family: 'Dancing Script', cursive; color: #d81b60; font-size: 2.5rem; margin-bottom: 15px; }
        p { line-height: 1.6; font-size: 1rem; }
    </style>
</head>
<body>

    <div id="stars"></div>

    <div class="cake-container" id="cakeUI">
        <div class="candle-wrapper">
            <div class="candle"><div class="flame" id="flame"></div></div>
        </div>
        <div class="layer layer-3"></div>
        <div class="layer layer-2"></div>
        <div class="layer layer-1"></div>
    </div>

    <div class="status" id="statusLabel">
        <button id="initBtn" onclick="start()">Reveal Your Surprise Amira ‚ú®</button>
    </div>

    <div id="message">
        <h1>Happy Birthday, Amira! üéÇ</h1>
        <p>Alam mo, sinubukan ko naman talagang ayusin yung logic ng code ko eh, pero kahit anong gawin ko, <b>'Ikaw'</b> pa rin talaga yung lumalabas na result. Haha! Wala talagang error basta pagdating sa'yo.</p>
        <p>Eto nga pala yung munting gift ko‚Äîginawa ko 'to nang may kasamang ngiti para lang mapasaya yung paborito kong birthday girl. Sana kahit malayo ka dyan sa Mindanao, maramdaman mo na special ka sa akin ngayon at araw-araw.</p>
        <p style="color: #d81b60; font-weight: bold;">You're the best part of my year. ‚ù§Ô∏è</p>
        <button onclick="location.reload()" style="background: #ff4081; color:white; border:none; padding:10px 20px; border-radius:20px; cursor:pointer; margin-top: 10px;">Watch Again</button>
    </div>

    <script>
        const starsContainer = document.getElementById('stars');
        for (let i = 0; i < 50; i++) {
            const star = document.createElement('div');
            star.className = 'sparkle';
            star.style.width = Math.random() * 3 + 'px';
            star.style.height = star.style.width;
            star.style.left = Math.random() * 100 + 'vw';
            star.style.top = Math.random() * 100 + 'vh';
            star.style.animationDelay = Math.random() * 2 + 's';
            starsContainer.appendChild(star);
        }

        function start() {
            document.getElementById('cakeUI').style.display = 'flex';
            document.getElementById('initBtn').style.display = 'none';
            document.getElementById('statusLabel').innerHTML = "Magical things are happening...";

            navigator.mediaDevices.getUserMedia({ audio: true })
            .then(stream => {
                setTimeout(() => {
                    document.getElementById('statusLabel').innerHTML = "üéÇ Your cake is ready!<br><b>Blow into the mic</b> to make a wish!";
                    listen(stream);
                }, 4500);
            })
            .catch(() => {
                setTimeout(() => {
                    document.getElementById('statusLabel').innerHTML = "Tap the candle to make a wish!";
                    document.getElementById('flame').onclick = blowOut;
                }, 4500);
            });
        }

        function listen(stream) {
            const ctx = new (window.AudioContext || window.webkitAudioContext)();
            const src = ctx.createMediaStreamSource(stream);
            const ana = ctx.createAnalyser();
            src.connect(ana);
            const data = new Uint8Array(ana.frequencyBinCount);

            function loop() {
                ana.getByteFrequencyData(data);
                const volume = data.reduce((a, b) => a + b) / data.length;
                if (volume > 45) { // Sensitivity
                    blowOut();
                    stream.getTracks().forEach(t => t.stop());
                } else { requestAnimationFrame(loop); }
            }
            loop();
        }

        function blowOut() {
            document.getElementById('flame').style.display = 'none';
            document.getElementById('statusLabel').style.display = 'none';
            setTimeout(() => {
                document.getElementById('message').style.display = 'block';
            }, 800);
        }
    </script>
</body>
</html>